Switch menu

Author: tar80 <tar80master@google.com>
License: MIT License
Repository: https://github.com/tar80/ppm-switchmenu
===============================================================================

普段使わないメニューを登録しておいて、必要なときだけ呼び出して使えます。
あらかじめプリセットメニューを作っておけば、いくつでも登録できます。

===============================================================================
ppm version0.92以降への更新方法

ppm version0.93からppmの運用システムが変更され、ppm-switchmenuも対応しています。
新システムへ更新するには以下の手順が必要になります。

1. "*ppmSetDefault"を実行し、"ppm-switchmenu"を指定する。
2. スイッチメニューを呼び出し、
   "1:ppm > 差分比較 > プリセットメニュー設定ファイル"を実行する。
3. "ppm.cfg"を選択し、差分を編集する。

ほぼすべての内容が変更されているため、差分更新よりも直接上書きしてから編集する
ほうが手間はかかりません。その場合、%sgu'ppmcache'\switchmenu\ppm.cfgを
%sgu'ppmrepo'\ppm-switchmenu\switchmenu\ppm.cfgで上書きしてから編集します。
なお、%sgu'ppmcache'\switchmenu\switchmenu.cfgはppm.cfgに統合されたため、削除
してもかまいせん。

===============================================================================
構成ファイルの説明

dist\addMenuItem.js
	設定ファイルswitchmenu.cfg内のプリセットメニューに新規メニューを追加する
dist\compareMenu.js
	ユーザープリセットメニューとデフォルトプリセットメニューを比較する
	ユーザー独自のプリセットメニューは比較できない
switchmenu\sortmode.cfg	ファイル振り分けモード用のメニュー
switchmenu\ppm.cfg	ppmコマンドをまとめたメニュー
template\newmenu.cfg	新規スイッチメニューのテンプレート

===============================================================================
テーブル情報

S_ppm#user:sw_cursor	スイッチ項目のカーソル位置(ショートカットキー)
S_ppm#user:sw_check	アクティブにするスイッチ項目(0ベース降順番号)
M_ppmSwitch	スイッチ項目
M_ppmSwitchSub	現在アクティブなスイッチメニュー項目
K_ppmSwitchKey	現在アクティブなスイッチメニューの一時登録キー

===============================================================================
デフォルトキー設定

PPc
	T	スイッチメニュー呼び出し

===============================================================================
プリセットメニュー

プリセットメニューはメニューごとに分割されたPPx設定ファイルです。ファイルの
一行目に";PLUGIN=<プラグイン名>"の記述が必要です。この記述はユーザー設定と
デフォルト設定の比較時に参照されます。

1:ppm	ppmコマンドをまとめたメニュー
	ppmメニューを利用するなら、%sgu'ppmcache'\config\ppx-plugin-
	manager.cfg内の*ppmコマンドは削除してもかまいません。
	削除した*ppmコマンドを再度登録したいときは、スイッチメニューで
	"1:ppm > 差分比較 > プラグイン設定ファイル"を実行し、ppx-plugin-manager
	を選択して差分を編集します。

	メニューからのコマンド実行時、引数が必要な場合は一行編集が起動します。
	この一行編集では補完候補が表示され、かつ無選択状態のときに、自動で
	最初の候補が選択されます。また、コマンドによってはShift+Enter押下で
	補助ダイアログが表示されます。

	編集(&E) > 指定したファイルをS_ppm#user:editorで編集します
		プラグイン設定ファイル(&P)
			プラグイン設定ファイルを編集
		ユーザー設定ファイル(&U)
			S_ppm#user:cfgdir配下のファイルを編集

		各種リスト(&L)
			%sgu'ppmcache'\list配下のファイルを編集
		補完候補リスト(&C)
			%sgu'ppmcache'\complist配下のファイルを編集
		ユーザースクリプト(&S)
			%sgu'ppmcache'\userscript配下のファイルを編集

		プリセットメニュー設定ファイル(&M)
			%sgu'ppmcache'\switchmenu配下のファイルを編集

	差分比較(&C) > 指定したファイルをS_ppm#user:compareで比較します
		プラグイン設定ファイル(&P)
			プラグインのユーザー設定とデフォルト設定を比較します
		バックアップ設定ファイル(&B)
			一行編集で選択した設定ファイルと現在の設定が
			書き出された一時ファイルを比較します
			その際に表示される設定更新用のダイアログは一時ファイルを
			対象とします

		プリセットメニュー設定ファイル(&M)
			スイッチメニュー用のユーザープリセットメニューを
			デフォルトプリセットメニューと比較します
			自作メニューには実行できません

	閲覧(&V) > 指定した内容をPPvで表示します
		ヘルプ(&H)		プラグインのヘルプを表示します

		アップデートログ(&U)	プラグインアップデート時のリザルトを表示します
					キーの一時割り当て:
					ENTER: カーソル行のコミット詳細を別PPvで開く
		カスタマイズの詳細(&D)	プラグインがPPxに登録した設定を表示します
					キーの一時割り当て:
					ENTER: カーソル行のプラグイン設定を編集する

	ディレクトリを開く(&O) > 指定したパスをPPcで開きます
		キャッシュ(&C)		%sgu'ppmcache'を開きます
		リポジトリ(&R)		%sgu'ppmrepo'を開きます

		スイッチメニュー設定ファイル(&S)
			%sgu'ppmcache'\switchmenuを開きます
		ユーザー設定ファイル(&U)	S_ppm#user:cfgdirを開きます

	プラグイン設定を登録(&S)	*ppmSetを実行します
		全プラグインを対象にするときは一行編集で"all"を指定します
	デフォルト設定を登録(&S)	*ppmSetDefaultを実行します
		全プラグインを対象にするときは一行編集で"all"を指定します
	プラグイン設定を削除(&D)	*ppmUnsetを実行します
		全プラグインを対象にするときは一行編集で"all"を指定します

	プラグインインストール(&I)	*ppmInstallを実行します
	プラグインアップデート(&U)	*ppmUpdateを実行します
	プラグインクリーンアップ(&D)	未使用のプラグインリポジトリを削除します

	ユーザー設定ファイルの管理(&M)	S_ppm#user:cfgdir配下のファイルから
		ppmで管理するファイルを指定します。
		指定したファイルは*ppmRestore,"システム > 設定をリセット"で
		使用されます

	システム(&S) >
		バックアップ設定ファイル作成(&B)
			現在の設定を%sgo'ppmcache'\backupに書き出します
		バックアップ設定ファイル読み込み(&L)
			%sgo'ppmcache'\backup配下のファイルを読み込み、
			PPxを再起動します

		PPxを初期化(&I)
			PPxを初期化後、再起動します
		設定をリセット(&R)
			PPxを初期化後、*ppmRestoreを実行します

		*ppmRestoreを登録(&T)
			*ppmRestoreを%0PPXDEF.CFGに追加します
		*ppmRestoreを登録解除(&T)
			*ppmRestoreを%0PPXDEF.CFGから削除します

		ppmをアンインストール
			PPxからプラグイン設定を削除し、%sgu'ppm'配下の"arch",
			"repo"ディレクトリを削除します

2:SortMode	ファイル振り分けモード
	1,2,3,4,5キーを使ってカーソル位置のファイルをディレクトリに振り分けます。
	振り分けられるディレクトリ名はそれぞれ"sort1","sort2",..."sort5"です。
	スイッチメニューからディレクトリ名を変更できます。

0:Create new menu	新規スイッチメニューを登録します


プリセットメニューを自作するには、以下のようにします。

1, スイッチメニューを開き、"0:Create new menu"を選択します。
2, 一行編集が起動し、新規メニュー名の入力が始まります。このとき、
  すでに同名の設定ファイルがあれば3,へ進みます。
  なければS_ppm#user:editorで<新規メニュー名>.cfgの編集が始まります。
  スイッチメニュー内に同名の項目がある場合はメッセージが表示されて終了します。
3, S_ppm#user:editorで、switchmenu設定ファイルの編集が始まります。
  新規メニューの項目が追加されているので必要な箇所を編集して保存します。
4, 最後に設定を読み込み、スイッチメニューを更新します。

<新規メニュー名>.cfgには比較対象となるデフォルト設定ファイルがないため、
一行目の";PLUGIN="にはプラグイン名を指定せず、そのままにしておきます。
一度作成されたメニュー.cfgは、スイッチメニューの
"1:ppm > 編集 > プリセットメニュー設定ファイル"で編集できます。

メニュー名と設定ファイル名は同名でなければなりません。大/小文字は無視されます。
同名でない場合、新規設定ファイルが作られ、"0:Create new menu""からはメニュー登録
できません。

================================================================================
